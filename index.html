<!DOCTYPE html>
<html>
    <head>
        <title>FastAPI Chat Test</title>
        <style>
            body { font-family: sans-serif; margin: 20px; }
            #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; }
            .status { color: gray; font-style: italic; }
        </style>
    </head>
    <body>
        <h2>Кімната: <span id="room-id-display">...</span></h2>
        <div id="messages"></div>
        <input type="text" id="messageText" autocomplete="off" placeholder="Напишіть повідомлення..."/>
        <button onclick="sendMessage()">Надіслати</button>
<script>
    // Запитуємо дані у користувача при вході
    const roomId = prompt("Введіть назву кімнати (наприклад, Potuzhni):", "Potuzhni");
    const userName = prompt("Ваше ім'я для чату:", "User_" + Math.floor(Math.random() * 100));
    
    document.getElementById('room-id-display').innerText = roomId;

    // ПІДКЛЮЧЕННЯ ДО ТВОГО СЕРВЕРА НА RENDER
    const ws = new WebSocket(`wss://chat-1-bwxb.onrender.com/ws/${roomId}/${userName}`);

    ws.onmessage = function(event) {
        const messages = document.getElementById('messages');
        const message = document.createElement('div');
        message.textContent = event.data;
        messages.appendChild(message);
        messages.scrollTop = messages.scrollHeight;
    };

    ws.onclose = function(event) {
        const messages = document.getElementById('messages');
        const status = document.createElement('div');
        status.className = 'status';
        // Виводимо причину, якщо кімната заповнена (код 1008)
        status.textContent = "З'єднання закрите. Причина: " + (event.reason || "Сервер спить або ліміт вичерпано");
        messages.appendChild(status);
    };

    function sendMessage() {
        const input = document.getElementById("messageText");
        if (input.value) {
            ws.send(input.value);
            input.value = '';
        }
    }
</script>
    </body>
</html>
